webpackJsonp([1],{0:function(t,e,n){n("briU"),t.exports=n("NHnr")},"0CwL":function(t,e,n){var i={"./af":"BDq7","./af.js":"BDq7","./ar":"5+h0","./ar-dz":"qUB5","./ar-dz.js":"qUB5","./ar-kw":"iOhK","./ar-kw.js":"iOhK","./ar-ly":"+qXE","./ar-ly.js":"+qXE","./ar-ma":"9CSN","./ar-ma.js":"9CSN","./ar-sa":"18kz","./ar-sa.js":"18kz","./ar-tn":"kPAx","./ar-tn.js":"kPAx","./ar.js":"5+h0","./az":"gGYd","./az.js":"gGYd","./be":"bwxU","./be.js":"bwxU","./bg":"JGhJ","./bg.js":"JGhJ","./bm":"Xru4","./bm.js":"Xru4","./bn":"7kNY","./bn.js":"7kNY","./bo":"PoV8","./bo.js":"PoV8","./br":"pKqw","./br.js":"pKqw","./bs":"/TJY","./bs.js":"/TJY","./ca":"YSL1","./ca.js":"YSL1","./cs":"6rWx","./cs.js":"6rWx","./cv":"uEOG","./cv.js":"uEOG","./cy":"HMVL","./cy.js":"HMVL","./da":"eJcm","./da.js":"eJcm","./de":"76Xd","./de-at":"wguz","./de-at.js":"wguz","./de-ch":"t9sU","./de-ch.js":"t9sU","./de.js":"76Xd","./dv":"qpG3","./dv.js":"qpG3","./el":"RU5T","./el.js":"RU5T","./en-au":"xkql","./en-au.js":"xkql","./en-ca":"LaAa","./en-ca.js":"LaAa","./en-gb":"q9zR","./en-gb.js":"q9zR","./en-ie":"wQFa","./en-ie.js":"wQFa","./en-il":"UOkQ","./en-il.js":"UOkQ","./en-nz":"tdgP","./en-nz.js":"tdgP","./eo":"+psB","./eo.js":"+psB","./es":"X8i8","./es-do":"Do8U","./es-do.js":"Do8U","./es-us":"0nXy","./es-us.js":"0nXy","./es.js":"X8i8","./et":"dguy","./et.js":"dguy","./eu":"3rUw","./eu.js":"3rUw","./fa":"V5p0","./fa.js":"V5p0","./fi":"7ewy","./fi.js":"7ewy","./fo":"VdSW","./fo.js":"VdSW","./fr":"lcbB","./fr-ca":"w6ES","./fr-ca.js":"w6ES","./fr-ch":"lp7T","./fr-ch.js":"lp7T","./fr.js":"lcbB","./fy":"PB+s","./fy.js":"PB+s","./gd":"4eWq","./gd.js":"4eWq","./gl":"6eiy","./gl.js":"6eiy","./gom-latn":"PoEu","./gom-latn.js":"PoEu","./gu":"52jv","./gu.js":"52jv","./he":"aGFt","./he.js":"aGFt","./hi":"ovgQ","./hi.js":"ovgQ","./hr":"sR8V","./hr.js":"sR8V","./hu":"jIBy","./hu.js":"jIBy","./hy-am":"rl7R","./hy-am.js":"rl7R","./id":"l+BE","./id.js":"l+BE","./is":"AcWJ","./is.js":"AcWJ","./it":"hMys","./it.js":"hMys","./ja":"rxB3","./ja.js":"rxB3","./jv":"8JrF","./jv.js":"8JrF","./ka":"Du88","./ka.js":"Du88","./kk":"ed4t","./kk.js":"ed4t","./km":"3MAz","./km.js":"3MAz","./kn":"NnY8","./kn.js":"NnY8","./ko":"9GQR","./ko.js":"9GQR","./ky":"82U/","./ky.js":"82U/","./lb":"4TvZ","./lb.js":"4TvZ","./lo":"kWxv","./lo.js":"kWxv","./lt":"hPoR","./lt.js":"hPoR","./lv":"VA5M","./lv.js":"VA5M","./me":"8KEV","./me.js":"8KEV","./mi":"sKWT","./mi.js":"sKWT","./mk":"8pEt","./mk.js":"8pEt","./ml":"Z9vE","./ml.js":"Z9vE","./mr":"y6v4","./mr.js":"y6v4","./ms":"5s/w","./ms-my":"4gdy","./ms-my.js":"4gdy","./ms.js":"5s/w","./mt":"/mn1","./mt.js":"/mn1","./my":"fpJ9","./my.js":"fpJ9","./nb":"Wc3u","./nb.js":"Wc3u","./ne":"h1XZ","./ne.js":"h1XZ","./nl":"hLQP","./nl-be":"Z2qm","./nl-be.js":"Z2qm","./nl.js":"hLQP","./nn":"6jUg","./nn.js":"6jUg","./pa-in":"WBhe","./pa-in.js":"WBhe","./pl":"tZSx","./pl.js":"tZSx","./pt":"OHwL","./pt-br":"A7w8","./pt-br.js":"A7w8","./pt.js":"OHwL","./ro":"uDQF","./ro.js":"uDQF","./ru":"kiL4","./ru.js":"kiL4","./sd":"/ctn","./sd.js":"/ctn","./se":"xTiq","./se.js":"xTiq","./si":"8uoX","./si.js":"8uoX","./sk":"/IH8","./sk.js":"/IH8","./sl":"eAL5","./sl.js":"eAL5","./sq":"+hX9","./sq.js":"+hX9","./sr":"VbzY","./sr-cyrl":"Fiaj","./sr-cyrl.js":"Fiaj","./sr.js":"VbzY","./ss":"q+uN","./ss.js":"q+uN","./sv":"3atA","./sv.js":"3atA","./sw":"CYjM","./sw.js":"CYjM","./ta":"HYkj","./ta.js":"HYkj","./te":"DPeS","./te.js":"DPeS","./tet":"owx7","./tet.js":"owx7","./tg":"vbyA","./tg.js":"vbyA","./th":"euk6","./th.js":"euk6","./tl-ph":"Pan4","./tl-ph.js":"Pan4","./tlh":"4KRO","./tlh.js":"4KRO","./tr":"D44C","./tr.js":"D44C","./tzl":"WDKa","./tzl.js":"WDKa","./tzm":"nrHS","./tzm-latn":"nBIm","./tzm-latn.js":"nBIm","./tzm.js":"nrHS","./ug-cn":"apxY","./ug-cn.js":"apxY","./uk":"zFgi","./uk.js":"zFgi","./ur":"RzSa","./ur.js":"RzSa","./uz":"vFmK","./uz-latn":"LVAz","./uz-latn.js":"LVAz","./uz.js":"vFmK","./vi":"oIIj","./vi.js":"oIIj","./x-pseudo":"8zQP","./x-pseudo.js":"8zQP","./yo":"tjlS","./yo.js":"tjlS","./zh-cn":"at/I","./zh-cn.js":"at/I","./zh-hk":"7xHM","./zh-hk.js":"7xHM","./zh-tw":"v/sX","./zh-tw.js":"v/sX"};function a(t){return n(s(t))}function s(t){var e=i[t];if(!(e+1))throw new Error("Cannot find module '"+t+"'.");return e}a.keys=function(){return Object.keys(i)},a.resolve=s,t.exports=a,a.id="0CwL"},"0ZKK":function(t,e){},"1aF/":function(t,e){},"6m5L":function(t,e){},BZD3:function(t,e){},EiqQ:function(t,e){},FBqa:function(t,e){},NHnr:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n("MVMM"),a={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app"}},[e("router-view")],1)},staticRenderFns:[]};var s=n("Z0/y")({name:"App"},a,!1,function(t){n("TxhG")},null,null).exports,o=n("zO6J"),r={name:"TopBar",props:{hasLoggedIn:Boolean,username:String},methods:{dropdownController:function(t){switch(t){case"logout":this.logout()}},logout:function(){var t=this;this.utils.http.delete("/api/session").then(function(e){switch(e.status){case 0:t.$Message.success("成功退出登录"),t.$router.push({name:"Login"});break;case 2:t.$Message.warning("您尚未登录"),t.$router.push({name:"Login"});break;default:t.utils.message.unknownError()}}).catch(function(){t.utils.message.unknownError()})}}},l={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"top-bar"},[n("div",{staticClass:"app-name"},[t._v(t._s(this.const.appName))]),t._v(" "),n("a",{staticClass:"username",attrs:{href:"javascript:void(0)"}},[t.hasLoggedIn?n("Dropdown",{attrs:{transfer:!0},on:{"on-click":t.dropdownController}},[n("span",{staticStyle:{color:"#fff"}},[t._v(t._s(t.username))]),t._v(" "),n("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[n("DropdownItem",{attrs:{name:"logout"}},[t._v("退出登录")])],1)],1):t._e()],1)])},staticRenderFns:[]};var c=n("Z0/y")(r,l,!1,function(t){n("Xps3")},"data-v-423522ac",null).exports,d={name:"NavBar",props:{role:Number},methods:{redirect:function(t){this.$router.push({name:t})}}},u={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"nav-bar"},[n("Menu",{attrs:{theme:"dark","active-name":this.$router.currentRoute.name,"open-names":["operation","management"],width:"auto"},on:{"on-select":t.redirect}},[n("Submenu",{attrs:{name:"operation"}},[n("template",{slot:"title"},[n("Icon",{attrs:{type:"ios-paper"}}),t._v("\n        运营\n      ")],1),t._v(" "),n("MenuItem",{directives:[{name:"show",rawName:"v-show",value:4===t.role,expression:"role === 4"}],attrs:{name:"SalesReport"}},[t._v("销售报表")]),t._v(" "),n("MenuItem",{directives:[{name:"show",rawName:"v-show",value:4===t.role,expression:"role === 4"}],attrs:{name:"RevenueList"}},[t._v("商户营收列表")]),t._v(" "),n("MenuItem",{attrs:{name:"GlobalNotice"}},[t._v("全局通知")]),t._v(" "),n("MenuItem",{attrs:{name:"RecommendedFood"}},[t._v("推荐菜品")]),t._v(" "),n("MenuItem",{attrs:{name:"Banner"}},[t._v("横幅广告")]),t._v(" "),n("MenuItem",{attrs:{name:"Feedback"}},[t._v("用户反馈")])],2),t._v(" "),n("Submenu",{attrs:{name:"management"}},[n("template",{slot:"title"},[n("Icon",{attrs:{type:"ios-people"}}),t._v("\n        管理\n      ")],1),t._v(" "),n("MenuItem",{attrs:{name:"DiningHall"}},[t._v("食堂管理")]),t._v(" "),n("MenuItem",{attrs:{name:"Stall"}},[t._v("商户管理")]),t._v(" "),n("MenuItem",{attrs:{name:"Food"}},[t._v("菜品管理")])],2)],1)],1)},staticRenderFns:[]};var m={components:{NavBar:n("Z0/y")(d,u,!1,function(t){n("SGix")},"data-v-65850159",null).exports,TopBar:c},name:"AppFrame",data:function(){return{hasLoggedIn:!1,username:"",role:-1}},methods:{checkSession:function(){var t=this;this.utils.http.get("/api/session").then(function(e){switch(e.status){case 0:t.hasLoggedIn=!0,t.username=e.username,t.role=e.role;break;case 2:t.hasLoggedIn=!1,t.username="",t.role=-1,t.utils.message.notLoggedIn();break;default:t.utils.message.unknownError()}}).catch(function(){t.utils.message.unknownError()})}},created:function(){this.checkSession()},beforeUpdate:function(){this.checkSession()}},h={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"wrapper"},[e("top-bar",{staticClass:"top-bar",attrs:{"has-logged-in":this.hasLoggedIn,username:this.username}}),this._v(" "),e("nav-bar",{staticClass:"nav-bar",attrs:{role:this.role}}),this._v(" "),e("router-view",{staticClass:"router-view"})],1)},staticRenderFns:[]};var g=n("Z0/y")(m,h,!1,function(t){n("S5xm")},"data-v-2c60a250",null).exports,p=n("HzJ8"),f=n.n(p),v={name:"Banner",data:function(){var t=this;return{Banner:[{type:"selection",width:60,align:"center",value:1},{title:"广告图片",key:"imageUrl",render:function(t,e){return t("div",{attrs:{style:"width: 40px;height: 40px;"}},[t("img",{props:{type:"primary",size:"small"},attrs:{src:e.row.imageUrl,style:"width: 40px;height: 40px;border-radius: 2px;"},style:{}})])}},{title:"URL",key:"link"},{title:"添加时间",key:"insertTime"},{title:"操作",key:"aa",width:200,render:function(e,n){return e("div",[e("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){t.editFormItems=t.bannerList[n.index],t.isEditModalVisible=!0}}},"修改"),e("Button",{props:{type:"error",size:"small"},style:{marginRight:"5px"},on:{click:function(){t.del(n.id)}}},"删除"),e("Button",{props:{type:"ghost",size:"small"},on:{click:function(){var e=n.index,i=t.bannerList;if(0!==e){var a=i.splice(e,1)[0];i.splice(e-1,0,a),t.isWeightChanged=!0}else t.$Message.warning("无法继续提升权重")}},style:{marginRight:"6px"}},[e("Icon",{props:{type:"arrow-up-b",size:16,color:"#2d8cf0"},style:{verticalAlign:"middle"}})]),e("Button",{props:{type:"ghost",size:"small"},on:{click:function(){var e=n.index,i=t.bannerList;if(e!==i.length-1){var a=i.splice(e,1)[0];i.splice(e+1,0,a),t.isWeightChanged=!0}else t.$Message.warning("无法继续降低权重")}}},[e("Icon",{props:{type:"arrow-down-b",size:16,color:"#2d8cf0"},style:{verticalAlign:"middle"}})])])}}],addModalImageSrc:"",addFormItems:{image:void 0,link:""},addFormRules:{name:[{type:"string",required:!0,message:"请填写名称"},{max:32,message:"内容过长"}],openHours:[{type:"array",len:2,required:!0,fields:{0:{type:"string",len:5,required:!0,pattern:/^([0, 1][0-9]|2[0-3]):[0-5][0-9]$/,message:"请选择营业时间"},1:{type:"string",len:5,required:!0,pattern:/^([0, 1][0-9]|2[0-3]):[0-5][0-9]$/,message:"请选择营业时间"}},message:"请选择营业时间"}],introduction:[{max:100,message:"内容过长"}]},isAddModalVisible:!1,isEditModalVisible:!1,editFormItems:{},bannerList:[],bannerClass:"change",file:"",selection:[],selectList:[],isWeightChanged:!1}},methods:{del:function(t){var e=this;this.utils.http.delete("/api/banners/"+t).then(function(t){switch(t.status){case 0:e.$Message.success("删除成功"),e.fetchBanner();break;case 2:e.utils.notLoggedIn()}}).catch(function(){return e.utils.unknownError})},fetchBanner:function(){var t=this;this.utils.http.get("/api/banners").then(function(e){switch(e.status){case 0:t.bannerList=e.info;var n=!0,i=!1,a=void 0;try{for(var s,o=f()(t.bannerList);!(n=(s=o.next()).done);n=!0){var r=s.value;r.imageUrl=t.const.imagePath.banner+r.imageUrl,r.insertTime=t.utils.moment(r.insertTime).format("YYYY-MM-DD HH:mm")}}catch(t){i=!0,a=t}finally{try{!n&&o.return&&o.return()}finally{if(i)throw a}}t.editFormItems=t.bannerList[0];break;case 2:t.utils.notLoggedIn()}}).catch(function(){return t.utils.unknownError})},select:function(t){this.selectList=t},selectAll:function(){this.selectList=this.bannerList},saveWeight:function(){var t=this,e=[];for(var n in this.bannerList)e.push(this.bannerList[n].id);this.utils.http.put("/api/banners/weight",{idList:e}).then(function(e){switch(e.status){case 0:t.$Message.success("权重修改成功"),t.isWeightChanged=!1,t.fetchBanner();break;case 2:t.utils.message.notLoggedIn();break;default:t.utils.message.unknownError()}}).catch(function(){t.utils.message.unknownError()})},saveChange:function(){},confirmBatchDeleteBanner:function(){var t=this;this.$Modal.confirm({title:"确认删除",content:"您确认要删除这"+this.selectList.length+"个广告吗？",onOk:function(){var e=[],n=!0,i=!1,a=void 0;try{for(var s,o=f()(t.selectList);!(n=(s=o.next()).done);n=!0){var r=s.value;e.push(r.id)}}catch(t){i=!0,a=t}finally{try{!n&&o.return&&o.return()}finally{if(i)throw a}}t.batchDeleteBanner(e)}})},batchDeleteBanner:function(t){var e=this;this.utils.http.delete("/api/banners",{idList:t}).then(function(t){switch(t.status){case 0:e.$Message.success("删除成功"),e.selectList=[],e.fetchBanner();break;case 2:e.utils.message.notLoggedIn();break;default:e.utils.message.unknownError()}}).catch(function(){e.utils.message.unknownError()})},insertBanner:function(){this.addFormItems={},this.isAddModalVisible=!0},handleEditImage:function(t){},handleAddImage:function(t){var e=this;this.addFormItems.image=t;var n=new FileReader;return n.readAsDataURL(t),n.onload=function(){e.addModalImageSrc=n.result},n.onerror=function(){e.utils.message.unknownError()},!1}},created:function(){this.fetchBanner()}},y={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("Modal",{attrs:{width:"512",closable:!1},model:{value:t.isAddModalVisible,callback:function(e){t.isAddModalVisible=e},expression:"isAddModalVisible"}},[n("Form",{ref:"addForm",attrs:{model:t.addFormItems,rules:t.addFormRules,"label-position":"top"},nativeOn:{submit:function(t){t.preventDefault()}}},[n("FormItem",{attrs:{prop:"image"}},[n("Upload",{staticStyle:{"text-align":"center"},attrs:{action:"",accept:"image/jpeg, image/png","before-upload":t.handleAddImage}},[n("Button",{staticStyle:{height:"120px",width:"480px",padding:"0"},attrs:{type:"dashed"}},[""===t.addModalImageSrc?n("Icon",{attrs:{type:"camera",size:"24"}}):t._e(),t._v(" "),""!==t.addModalImageSrc?n("img",{staticStyle:{height:"100%",width:"100%"},attrs:{src:t.addModalImageSrc}}):t._e()],1)],1)],1),t._v(" "),n("FormItem",{attrs:{label:"链接",prop:"name"}},[n("Input",{model:{value:t.addFormItems.link,callback:function(e){t.$set(t.addFormItems,"link",e)},expression:"addFormItems.link"}},[n("span",{attrs:{slot:"prepend"},slot:"prepend"},[t._v("http://")])])],1)],1),t._v(" "),n("div",{attrs:{slot:"footer"},slot:"footer"},[n("Button",{attrs:{type:"primary",size:"large",long:""},on:{click:t.insertBanner}},[t._v("添加")])],1)],1),t._v(" "),n("Modal",{attrs:{width:"512",closable:!1},model:{value:t.isEditModalVisible,callback:function(e){t.isEditModalVisible=e},expression:"isEditModalVisible"}},[n("Form",{ref:"editForm",attrs:{model:t.editFormItems,rules:t.addFormRules,"label-position":"top"},nativeOn:{submit:function(t){t.preventDefault()}}},[n("FormItem",{attrs:{prop:"image"}},[n("Upload",{staticStyle:{"text-align":"center"},attrs:{action:"",accept:"image/jpeg, image/png","before-upload":t.handleEditImage}},[n("Button",{staticStyle:{height:"120px",width:"480px",padding:"0"},attrs:{type:"dashed"}},[""!==t.editFormItems.imageUrl?n("img",{staticStyle:{height:"100%",width:"100%"},attrs:{src:t.editFormItems.imageUrl}}):t._e()])],1)],1),t._v(" "),n("FormItem",{attrs:{label:"链接",prop:"name"}},[n("Input",{model:{value:t.editFormItems.link.split("http://")[1],callback:function(e){t.$set(t.editFormItems.link.split("http://"),1,e)},expression:"editFormItems.link.split('http://')[1]"}},[n("span",{attrs:{slot:"prepend"},slot:"prepend"},[t._v("http://")])])],1)],1),t._v(" "),n("div",{attrs:{slot:"footer"},slot:"footer"},[n("Button",{attrs:{type:"primary",size:"large",long:""},on:{click:t.saveChange}},[t._v("保存")])],1)],1),t._v(" "),n("div",{staticStyle:{"margin-bottom":"24px","text-align":"right"}},[n("Button",{attrs:{type:"success"},on:{click:t.insertBanner}},[t._v("添加\n    ")]),t._v(" "),n("Button",{attrs:{type:"error",disabled:0===t.selectList.length},on:{click:t.confirmBatchDeleteBanner}},[t._v("批量刪除\n    ")]),t._v(" "),n("Button",{attrs:{type:"primary",disabled:!t.isWeightChanged},on:{click:t.saveWeight}},[t._v("保存权重")])],1),t._v(" "),n("div",[n("Table",{attrs:{id:"Banner",columns:t.Banner,data:t.bannerList},on:{"on-selection-change":t.select,"on-select-all":t.selectAll}})],1)],1)},staticRenderFns:[]};var b=n("Z0/y")(v,y,!1,function(t){n("cHse")},"data-v-5f8975d1",null).exports,k=n("rVsN"),w=n.n(k),L={name:"DiningHall",data:function(){var t=this;this.$createElement;return{tableHeight:0,isTableLoading:!1,isWeightChanged:!1,columns:[{type:"selection",width:"60",align:"center"},{title:"食堂名称",key:"name",ellipsis:!0},{title:"营业时间",key:"openHours"},{title:"介绍",key:"introduction",ellipsis:!0},{title:"更新时间",key:"updateTime"},{title:"操作",align:"center",width:200,render:function(e,n){var i=n.index,a=n.row.id,s=n.row.name;return e("div",{style:"line-height: 48px;"},[e("Button",{attrs:{type:"primary",size:"small"},style:"margin-right: 10px;",on:{click:function(){t.showEditModal(i)}}},["修改"]),e("Button",{attrs:{type:"error",size:"small"},style:"margin-right: 10px",on:{click:function(){t.handleDelete(a,s)}}},["删除"]),e("Button",{attrs:{type:"ghost",size:"small"},style:"margin-right: 6px;",on:{click:function(){if(0!==i){var e=t.diningHallList.splice(i,1)[0];t.diningHallList.splice(i-1,0,e),t.isWeightChanged=!0}else t.$Message.warning("无法继续提升权重")}}},[e("Icon",{attrs:{type:"arrow-up-b",size:"16",color:"#2d8cf0"},style:"vertical-align: middle;"})]),e("Button",{attrs:{type:"ghost",size:"small"},on:{click:function(){if(i!==t.diningHallList.length-1){var e=t.diningHallList.splice(i,1)[0];t.diningHallList.splice(i+1,0,e),t.isWeightChanged=!0}else t.$Message.warning("无法继续降低权重")}}},[e("Icon",{attrs:{type:"arrow-down-b",size:"16",color:"#2d8cf0"},style:"vertical-align: middle;"})])])}}],diningHallList:[],selectedDiningHallList:[],isAddModalVisible:!1,isEditModalVisible:!1,addFormItems:{image:void 0,imageDataUrl:"",name:"",openHours:["",""],introduction:""},editFormItems:{id:-1,name:"",openHours:["",""],introduction:"",imageSrc:""},formRules:{name:[{type:"string",required:!0,message:"请填写名称"},{max:32,message:"内容过长"}],openHours:[{type:"array",len:2,required:!0,fields:{0:{type:"string",len:5,required:!0,pattern:/^([0, 1][0-9]|2[0-3]):[0-5][0-9]$/,message:"请选择营业时间"},1:{type:"string",len:5,required:!0,pattern:/^([0, 1][0-9]|2[0-3]):[0-5][0-9]$/,message:"请选择营业时间"}},message:"请选择营业时间"}],introduction:[{max:100,message:"内容过长"}]}}},methods:{fetchDiningHallList:function(){var t=this;this.isTableLoading=!0,this.utils.http.get("/api/dining-halls").then(function(e){switch(e.status){case 0:for(var n=e.info,i=0;i<n.length;i++){var a=n[i],s=t.utils.moment(a.startTime,"HH:mm:ss").format("HH:mm"),o=t.utils.moment(a.endTime,"HH:mm:ss").format("HH:mm");a.openHours=s+" - "+o,a.updateTime=t.utils.moment(a.updateTime).format("YYYY-MM-DD HH:mm:ss")}t.diningHallList=n;break;case 2:t.utils.message.notLoggedIn();break;default:t.utils.message.unknownError()}t.isTableLoading=!1}).catch(function(){t.utils.message.unknownError(),t.isTableLoading=!1})},handleDelete:function(t,e){var n=this;this.$Modal.confirm({title:"确认删除",content:"您确认要删除"+e+"吗？",onOk:function(){n.deleteDiningHall(t,e)}})},deleteDiningHall:function(t,e){var n=this;this.utils.http.delete("/api/dining-halls/"+t).then(function(t){switch(t.status){case 0:n.$Message.success("成功删除"+e),n.fetchDiningHallList();break;case 2:n.utils.message.notLoggedIn();break;default:n.utils.message.unknownError()}}).catch(function(){n.utils.message.unknownError()})},handleMassDelete:function(){var t=this;this.$Modal.confirm({title:"确认删除",content:"您确认要删除这"+this.selectedDiningHallList.length+"个食堂吗？",onOk:function(){var e=[],n=!0,i=!1,a=void 0;try{for(var s,o=f()(t.selectedDiningHallList);!(n=(s=o.next()).done);n=!0){var r=s.value;e.push(r.id)}}catch(t){i=!0,a=t}finally{try{!n&&o.return&&o.return()}finally{if(i)throw a}}t.requestMassDelete(e)}})},requestMassDelete:function(t){var e=this;this.utils.http.delete("/api/dining-halls",{idList:t}).then(function(t){switch(t.status){case 0:e.$Message.success("删除成功"),e.fetchDiningHallList();break;case 2:e.utils.message.notLoggedIn();break;default:e.utils.message.unknownError()}}).catch(function(){e.utils.message.unknownError()})},saveWeight:function(){var t=this,e=[];for(var n in this.diningHallList)e.push(this.diningHallList[n].id);this.utils.http.put("/api/dining-halls/weight",{idList:e}).then(function(e){switch(e.status){case 0:t.$Message.success("权重修改成功"),t.isWeightChanged=!1,t.fetchDiningHallList();break;case 2:t.utils.message.notLoggedIn();break;default:t.utils.message.unknownError()}}).catch(function(){t.utils.message.unknownError()})},validateImage:function(t){var e=t.size,n=this.const.upload.image.maxSize;if(e>n){var i=n<1048576?Math.round(n/1024*100)/100+" Kib":Math.round(n/1024/1024*100)/100+" Mib";return this.$Message.warning("文件过大，最大允许 "+i),!1}for(var a=t.type,s=this.const.upload.image.acceptMimeTypes.split(","),o=0;o<s.length;o++)s[o]=s[o].trim();return-1!==s.indexOf(a)||(this.$Message.warning("文件格式不正确"),!1)},handleAddImage:function(t){var e=this;if(!this.validateImage(t))return!1;this.addFormItems.image=t;var n=new FileReader;return n.readAsDataURL(t),n.onload=function(){e.addFormItems.imageDataUrl=n.result},n.onerror=function(){e.utils.message.unknownError()},!1},handleAdd:function(){var t=this;this.validateAdd().then(function(){return t.requestAdd()}).then(function(e){switch(e.status){case 0:t.$Message.success("添加成功"),t.fetchDiningHallList();break;case 2:t.utils.message.notLoggedIn();break;default:t.utils.message.unknownError()}}).catch(function(e){switch(e.cause){case"validate":t.$nextTick(function(){t.isAddModalVisible=!0});break;case"request":t.utils.message.unknownError()}})},validateAdd:function(){var t=this;return new w.a(function(e,n){t.$refs.addForm.validate().then(function(t){t&&e();var i=new Error;i.cause="validate",n(i)})})},requestAdd:function(){var t=this.addFormItems;return this.utils.http.post("/api/dining-halls",{name:t.name,startTime:t.openHours[0]+":00",endTime:t.openHours[1]+":00",introduction:t.introduction,file:t.image})},resetAddForm:function(){this.$refs.addForm.resetFields(),this.addFormItems.imageDataUrl=""},showEditModal:function(t){var e=this.diningHallList[t],n=this.editFormItems;n.id=e.id,n.name=e.name,n.openHours=e.openHours,n.introduction=e.introduction,n.imageSrc=this.const.imagePath.diningHall+e.imageUrl,this.isEditModalVisible=!0},handleChangeImage:function(t){var e=this;return!!this.validateImage(t)&&(this.requestChangeImage(t).then(function(t){switch(t.status){case 0:e.$Message.success("图片修改成功");var n=t.info,i=e.const.imagePath.diningHall+n;e.editFormItems.imageSrc=i;var a=e.editFormItems.id,s=!0,o=!1,r=void 0;try{for(var l,c=f()(e.diningHallList);!(s=(l=c.next()).done);s=!0){var d=l.value;d.id===a&&(d.imageUrl=n)}}catch(t){o=!0,r=t}finally{try{!s&&c.return&&c.return()}finally{if(o)throw r}}break;case 2:e.utils.message.notLoggedIn();break;default:e.utils.message.unknownError()}}).catch(function(){e.utils.message.unknownError()}),!1)},requestChangeImage:function(t){var e="/api/dining-halls/"+this.editFormItems.id+"/image";return this.utils.http.put(e,{file:t})},handleEdit:function(){var t=this;this.validateEdit().then(function(){return t.requestEdit()}).then(function(e){switch(e.status){case 0:t.$Message.success("食堂修改成功"),t.fetchDiningHallList();break;case 2:t.utils.message.notLoggedIn();break;default:t.utils.message.unknownError()}}).catch(function(e){switch(e.cause){case"validate":t.$nextTick(function(){t.isEditModalVisible=!0});break;case"request":t.utils.message.unknownError()}})},validateEdit:function(){var t=this;return new w.a(function(e,n){t.$refs.editForm.validate().then(function(t){t&&e();var i=new Error;i.cause="validate",n(i)})})},requestEdit:function(){var t=this.editFormItems,e="/api/dining-halls/"+t.id;return this.utils.http.put(e,{name:t.name,startTime:t.openHours[0]+":00",endTime:t.openHours[1]+":00",introduction:t.introduction})},resetEditForm:function(){this.$refs.editForm.resetFields(),this.editFormItems.id=-1,this.editFormItems.imageSrc=""}},created:function(){this.fetchDiningHallList();var t=window.innerHeight;this.tableHeight=.8*(t-160)}},x={render:function(){var t=this,e=this,n=e.$createElement,i=e._self._c||n;return i("div",[i("div",[i("div",{staticStyle:{"text-align":"right","margin-bottom":"24px"}},[i("Button",{staticStyle:{"margin-right":"10px"},attrs:{type:"success",size:"large"},on:{click:function(t){e.isAddModalVisible=!0}}},[e._v("添加")]),e._v(" "),i("Button",{staticStyle:{"margin-right":"10px"},attrs:{type:"error",size:"large",disabled:0===e.selectedDiningHallList.length},on:{click:e.handleMassDelete}},[e._v("\n        批量删除\n      ")]),e._v(" "),i("Button",{attrs:{type:"primary",size:"large",disabled:!e.isWeightChanged},on:{click:e.saveWeight}},[e._v("保存权重")])],1),e._v(" "),i("Table",{attrs:{columns:e.columns,data:e.diningHallList,loading:e.isTableLoading,height:e.tableHeight},on:{"on-selection-change":function(e){t.selectedDiningHallList=e}}})],1),e._v(" "),i("Modal",{attrs:{title:"添加食堂",width:"320"},on:{"on-ok":e.handleAdd,"on-cancel":e.resetAddForm},model:{value:e.isAddModalVisible,callback:function(t){e.isAddModalVisible=t},expression:"isAddModalVisible"}},[i("Form",{ref:"addForm",attrs:{model:e.addFormItems,rules:e.formRules,"label-position":"top"},nativeOn:{submit:function(t){t.preventDefault()}}},[i("FormItem",{attrs:{prop:"image"}},[i("Upload",{staticStyle:{"text-align":"center"},attrs:{action:"",accept:this.const.upload.image.acceptMimeTypes,"before-upload":e.handleAddImage}},[i("Button",{staticStyle:{height:"120px",width:"288px",padding:"0"},attrs:{type:"dashed"}},[""===e.addFormItems.imageDataUrl?i("Icon",{attrs:{type:"camera",size:"24"}}):e._e(),e._v(" "),""!==e.addFormItems.imageDataUrl?i("img",{staticStyle:{height:"100%",width:"100%"},attrs:{src:e.addFormItems.imageDataUrl}}):e._e()],1)],1)],1),e._v(" "),i("FormItem",{attrs:{label:"食堂名称",prop:"name"}},[i("Input",{attrs:{placeholder:"请输入食堂名称",clearable:!0},model:{value:e.addFormItems.name,callback:function(t){e.$set(e.addFormItems,"name",t)},expression:"addFormItems.name"}})],1),e._v(" "),i("FormItem",{attrs:{label:"营业时间",prop:"openHours"}},[i("TimePicker",{staticStyle:{width:"100%"},attrs:{type:"timerange",format:"HH:mm",steps:[1,5],editable:!1,placeholder:"请选择营业时间"},on:{"on-open-change":function(t){t||e.$refs.addForm.validateField("openHours")}},model:{value:e.addFormItems.openHours,callback:function(t){e.$set(e.addFormItems,"openHours",t)},expression:"addFormItems.openHours"}})],1),e._v(" "),i("FormItem",{attrs:{label:"食堂介绍",prop:"introduction"}},[i("Input",{attrs:{type:"textarea",rows:3,placeholder:"请输入食堂介绍"},model:{value:e.addFormItems.introduction,callback:function(t){e.$set(e.addFormItems,"introduction",t)},expression:"addFormItems.introduction"}})],1)],1)],1),e._v(" "),i("Modal",{attrs:{title:"修改食堂",width:"320"},on:{"on-ok":e.handleEdit,"on-cancel":e.resetEditForm},model:{value:e.isEditModalVisible,callback:function(t){e.isEditModalVisible=t},expression:"isEditModalVisible"}},[i("Form",{ref:"editForm",attrs:{model:e.editFormItems,rules:e.formRules,"label-position":"top"},nativeOn:{submit:function(t){t.preventDefault()}}},[i("FormItem",{attrs:{prop:"image"}},[i("Upload",{staticStyle:{"text-align":"center"},attrs:{action:"",accept:this.const.upload.image.acmity,"before-upload":e.handleChangeImage}},[i("Button",{staticStyle:{height:"120px",width:"288px",padding:"0"},attrs:{type:"dashed"}},[""===e.editFormItems.imageSrc?i("Icon",{attrs:{type:"camera",size:"24"}}):e._e(),e._v(" "),""!==e.editFormItems.imageSrc?i("img",{staticStyle:{height:"100%",width:"100%"},attrs:{src:e.editFormItems.imageSrc,alt:"食堂图片"}}):e._e()],1)],1)],1),e._v(" "),i("FormItem",{attrs:{label:"食堂名称",prop:"name"}},[i("Input",{attrs:{placeholder:"请输入食堂名称",clearable:!0},model:{value:e.editFormItems.name,callback:function(t){e.$set(e.editFormItems,"name",t)},expression:"editFormItems.name"}})],1),e._v(" "),i("FormItem",{attrs:{label:"营业时间",prop:"openHours"}},[i("TimePicker",{staticStyle:{width:"100%"},attrs:{type:"timerange",format:"HH:mm",steps:[1,5],editable:!1,placeholder:"请选择营业时间"},on:{"on-open-change":function(t){t||e.$refs.editForm.validateField("openHours")}},model:{value:e.editFormItems.openHours,callback:function(t){e.$set(e.editFormItems,"openHours",t)},expression:"editFormItems.openHours"}})],1),e._v(" "),i("FormItem",{attrs:{label:"食堂介绍",prop:"introduction"}},[i("Input",{attrs:{type:"textarea",rows:3,placeholder:"请输入食堂介绍"},model:{value:e.editFormItems.introduction,callback:function(t){e.$set(e.editFormItems,"introduction",t)},expression:"editFormItems.introduction"}})],1)],1)],1)],1)},staticRenderFns:[]};var F=n("Z0/y")(L,x,!1,function(t){n("nBlQ")},"data-v-415e055a",null).exports,I={name:"Feedback",data:function(){return{dataCount:0,pageSize:8,feedbackDetailFlag:!1,feedback:"",historyColumns:[{title:"反馈信息",align:"center",key:"content",ellipsis:!0},{title:"反馈时间",align:"center",key:"insertTime"}],historyData:[],pageNum:1}},methods:{changePage:function(t){var e=this;this.pageNum=t,this.utils.http.get("/api/feedback",{pageNum:this.pageNum,pageSize:this.pageSize}).then(function(t){switch(t.status){case 0:e.historyData=t.info,e.dataCount=t.totalCount;break;case 2:e.utils.notLoggedIn()}}).catch(function(){return e.utils.unknownError})},getFeedback:function(){var t=this;this.utils.http.get("/api/feedback",{pageSize:this.pageSize,pageNum:this.pageNum}).then(function(e){switch(e.status){case 0:t.historyData=e.info;var n=!0,i=!1,a=void 0;try{for(var s,o=f()(t.historyData);!(n=(s=o.next()).done);n=!0){var r=s.value;r.insertTime=t.utils.moment(r.insertTime).format("YYYY-MM-DD HH:mm")}}catch(t){i=!0,a=t}finally{try{!n&&o.return&&o.return()}finally{if(i)throw a}}t.dataCount=e.totalCount;break;case 2:t.utils.notLoggedIn()}}).catch(function(){return t.utils.unknownError})},showFeedback:function(t){this.feedbackDetailFlag=!0,this.feedback=t.content}},created:function(){this.getFeedback()}},_={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("Modal",{attrs:{width:"360"},model:{value:t.feedbackDetailFlag,callback:function(e){t.feedbackDetailFlag=e},expression:"feedbackDetailFlag"}},[n("div",{attrs:{slot:"header"},slot:"header"},[n("div",[t._v("\n        用户反馈\n      ")])]),t._v(" "),n("div",{staticStyle:{padding:"0 12px"}},[t._v("\n      "+t._s(t.feedback)+"\n    ")]),t._v(" "),n("div",{attrs:{slot:"footer"},slot:"footer"},[n("Button",{attrs:{type:"primary",size:"large",long:""},on:{click:function(e){t.feedbackDetailFlag=!1}}},[t._v("关闭")])],1)]),t._v(" "),n("div",{staticStyle:{margin:"30px 60px"}},[n("div",[n("Table",{attrs:{columns:t.historyColumns,data:t.historyData},on:{"on-row-click":t.showFeedback}})],1),t._v(" "),t.dataCount>t.pageSize?n("div",{staticStyle:{float:"right"}},[n("Page",{attrs:{total:t.dataCount,"page-size":t.pageSize,"show-total":""},on:{"on-change":t.changePage}})],1):t._e()])],1)},staticRenderFns:[]};var j=n("Z0/y")(I,_,!1,function(t){n("6m5L")},"data-v-46621914",null).exports,S={name:"Food",data:function(){var t=this;return{ajaxHistoryData:[],dataCount:0,pageSize:8,foodColumns:[{title:"菜品名称",align:"center",key:"name"},{title:"成本会员价格",align:"center",key:"memberPriceCost"},{title:"实际会员价格",align:"center",key:"memberPrice"},{title:"会员价数量",align:"center",key:"memberPriceLimit"},{title:"销量",align:"center",key:"saleCount"},{title:"操作",align:"center",render:function(e,n){return e("div",[e("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){t.foodDetail=!0,t.food=t.utils.cloneObject(t.foodList[n.index])}}},"修改")])}}],ruleInline:{memberPriceCost:[{required:!0,message:"请输入"},{message:"请正确输入",trigger:"blur",pattern:/^\d{1,6}(\.\d{1,2}){0,1}$/}],memberPrice:[{required:!0,message:"请输入"},{message:"请正确输入",trigger:"blur",pattern:/^\d{1,6}(\.\d{1,2}){0,1}$/}],memberPriceLimit:[{required:!0,message:"请输入"},{pattern:/^\d{1,9}$/,message:"请正确输入"}],saleCount:[{required:!0,message:"请输入"},{pattern:/^\d{1,9}$/,message:"请正确输入"}]},foodDetail:!1,foodList:[],food:{},selectData:[],diningHallList:[],stallList:[],foodCategoryList:[],diningHall:"",stall:"",foodCategory:"",id:"",loading:!1,memberPriceLimit:"",pageNum:1}},methods:{getDiningHall:function(){var t=this;this.utils.http.get("/api/dining-halls").then(function(e){switch(e.status){case 0:t.diningHallList=e.info,t.selectData=e.info();break;case 2:t.utils.notLoggedIn()}}).catch(function(){return t.utils.unknownError})},diningHallSel:function(t){var e=this;this.utils.http.get("/api/dining-halls/"+t+"/stalls").then(function(t){switch(t.status){case 0:e.stallList=t.info;break;case 2:e.utils.notLoggedIn()}}).catch(function(){return e.utils.unknownError})},stallSel:function(t){var e=this;this.utils.http.get("/api/stalls/"+t+"/food-categories").then(function(t){switch(t.status){case 0:e.foodCategoryList=t.info;break;case 2:e.utils.notLoggedIn()}}).catch(function(){return e.utils.unknownError})},foodCategorySel:function(t){var e=this;this.loading=!0,this.utils.http.get("/api/food-categories/"+t+"/food",{pageNum:1,pageSize:this.pageSize}).then(function(t){switch(t.status){case 0:e.loading=!1,e.foodList=t.info,e.food=e.utils.cloneObject(e.foodList[0]),e.dataCount=t.totalCount;break;case 2:e.utils.notLoggedIn()}}).catch(function(){return e.utils.unknownError})},changePage:function(t){this.loading=!0,this.pageNum=t,this.getFoodList(),0!==this.foodList.length&&(this.food=this.utils.cloneObject(this.foodList[0]))},getFoodList:function(){var t=this;this.utils.http.get("/api/food-categories/"+this.foodCategory+"/food",{pageNum:this.pageNum,pageSize:this.pageSize}).then(function(e){switch(e.status){case 0:t.loading=!1,t.foodList=t.checkIsMember(e.info),t.dataCount=e.totalCount;break;case 2:t.utils.notLoggedIn()}}).catch(function(){return t.utils.unknownError})},saveChange:function(){var t=this;this.$refs.editForm.validate().then(function(e){if(e){if(t.food.memberPriceCost>t.food.memberPrice)return void t.$Message.error("会员成本价不得高于会员价");t.utils.http.put("/api/food/"+t.food.id,{memberPriceCost:t.food.memberPriceCost,memberPrice:t.food.memberPrice,memberPriceLimit:t.food.memberPriceLimit,saleCount:t.food.saleCount}).then(function(e){switch(e.status){case 0:t.$Message.success("修改成功"),t.getFoodList();break;case 2:t.utils.notLoggedIn()}}).catch(function(){return t.utils.unknownError})}})},checkIsMember:function(t){var e=!0,n=!1,i=void 0;try{for(var a,s=f()(t);!(e=(a=s.next()).done);e=!0){var o=a.value;o.memberPrice||(o.memberPrice=0,o.memberPriceCost=0,o.memberPriceLimit=0)}}catch(t){n=!0,i=t}finally{try{!e&&s.return&&s.return()}finally{if(n)throw i}}return t}},created:function(){this.getDiningHall()}},M={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("Modal",{model:{value:t.foodDetail,callback:function(e){t.foodDetail=e},expression:"foodDetail"}},[n("div",{attrs:{slot:"header"},slot:"header"},[n("div",[t._v("\n        菜品管理\n      ")])]),t._v(" "),n("div",[n("Form",{ref:"editForm",attrs:{model:t.food,rules:t.ruleInline,"label-position":"top"}},[n("FormItem",{attrs:{prop:"name",label:"菜品名称"}},[n("div",[t._v("\n            "+t._s(t.food.name)+"\n          ")])]),t._v(" "),n("FormItem",{attrs:{prop:"memberPriceCost",label:"会员成本价"}},[n("Input",{attrs:{type:"text",placeholder:"会员成本价"},model:{value:t.food.memberPriceCost,callback:function(e){t.$set(t.food,"memberPriceCost",e)},expression:"food.memberPriceCost"}})],1),t._v(" "),n("FormItem",{attrs:{prop:"memberPrice",label:"会员价"}},[n("Input",{attrs:{type:"text",placeholder:"会员价"},model:{value:t.food.memberPrice,callback:function(e){t.$set(t.food,"memberPrice",e)},expression:"food.memberPrice"}})],1),t._v(" "),n("FormItem",{attrs:{prop:"memberPriceLimit",label:"会员价限量"}},[n("Input",{attrs:{type:"text",placeholder:"会员价限量"},model:{value:t.food.memberPriceLimit,callback:function(e){t.$set(t.food,"memberPriceLimit",e)},expression:"food.memberPriceLimit"}})],1),t._v(" "),n("FormItem",{attrs:{prop:"saleCount",label:"销售数量"}},[n("Input",{attrs:{type:"text",placeholder:"销售数量"},model:{value:t.food.saleCount,callback:function(e){t.$set(t.food,"saleCount",e)},expression:"food.saleCount"}})],1)],1)],1),t._v(" "),n("div",{attrs:{slot:"footer"},slot:"footer"},[n("Button",{attrs:{type:"primary",size:"large",long:""},on:{click:t.saveChange}},[t._v("修改")])],1)]),t._v(" "),n("div",{staticStyle:{width:"100%",overflow:"auto",zoom:"1","margin-bottom":"40px"}},[n("div",{staticStyle:{display:"block",float:"left","margin-right":"3%"}},[t._v("\n      食堂:\n      "),n("Select",{staticStyle:{width:"250px"},on:{"on-change":function(e){t.diningHallSel(t.diningHall)}},model:{value:t.diningHall,callback:function(e){t.diningHall=e},expression:"diningHall"}},t._l(t.diningHallList,function(e){return n("Option",{key:e.id,attrs:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),n("div",{staticStyle:{display:"block",float:"left","margin-right":"3%"}},[t._v("\n      商家:\n      "),n("Select",{staticStyle:{width:"250px"},on:{"on-change":function(e){t.stallSel(t.stall)}},model:{value:t.stall,callback:function(e){t.stall=e},expression:"stall"}},t._l(t.stallList,function(e){return n("Option",{key:e.id,attrs:{value:e.id,selected:""}},[t._v(t._s(e.name))])}))],1),t._v(" "),n("div",{staticStyle:{display:"block",float:"left"}},[t._v("\n      菜品分类:\n      "),n("Select",{staticStyle:{width:"250px"},on:{"on-change":function(e){t.foodCategorySel(t.foodCategory)}},model:{value:t.foodCategory,callback:function(e){t.foodCategory=e},expression:"foodCategory"}},t._l(t.foodCategoryList,function(e){return n("Option",{key:e.id,attrs:{value:e.id,selected:""}},[t._v(t._s(e.name))])}))],1)]),t._v(" "),n("div",{},[n("div",[n("Table",{attrs:{loading:t.loading,columns:t.foodColumns,data:t.foodList}})],1),t._v(" "),t.dataCount>t.pageSize?n("div",{staticStyle:{float:"right"}},[n("Page",{attrs:{total:t.dataCount,"page-size":t.pageSize,"show-total":""},on:{"on-change":t.changePage}})],1):t._e()])],1)},staticRenderFns:[]};var C=n("Z0/y")(S,M,!1,function(t){n("hPbS")},null,null).exports,E={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"body-background"},[n("div",{staticClass:"body"},[n("div",{staticClass:"title"},[t._v("全局通知:")]),t._v(" "),n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.currentNotification,expression:"currentNotification"}],staticClass:"ivu-input textarea",attrs:{placeholder:"请输入通知信息",maxlength:"100"},domProps:{value:t.currentNotification},on:{input:function(e){e.target.composing||(t.currentNotification=e.target.value)}}}),t._v(" "),n("div",{staticClass:"btn-group"},[n("Button",{attrs:{type:"error"},on:{click:function(e){t.resetNotice()}}},[t._v("重置")]),t._v(" "),n("Button",{attrs:{type:"primary"},on:{click:function(e){t.updNotice()}}},[t._v("保存")])],1)])])])},staticRenderFns:[]};var H=n("Z0/y")({name:"GlobalNotice",data:function(){return{historyData:[],pageNum:1,currentNotification:"",alternateNotice:""}},methods:{getGlobalNotice:function(){var t=this;this.utils.http.get("/api/global-notices").then(function(e){switch(e.status){case 0:t.currentNotification=e.globalNoticeList[0].content,t.alternateNotice=e.globalNoticeList[0].content;break;case 2:t.utils.notLoggedIn()}}).catch(function(){return t.utils.unknownError})},updNotice:function(){var t=this;this.utils.http.put("/api/global-notices",{content:this.currentNotification}).then(function(e){switch(e.status){case 2:t.utils.notLoggedIn()}}).catch(function(){return t.utils.unknownError})},resetNotice:function(){this.currentNotification=this.alternateNotice}},created:function(){this.getGlobalNotice()}},E,!1,function(t){n("BZD3")},"data-v-6d65c568",null).exports,D={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"wrapper"},[n("Card",{staticStyle:{width:"320px"}},[n("span",{attrs:{slot:"title"},slot:"title"},[t._v("登录")]),t._v(" "),n("Input",{staticStyle:{"margin-bottom":"16px"},attrs:{size:"large",placeholder:"用户名",clearable:"",autofocus:"",autocomplete:"on"},on:{"on-enter":t.login},model:{value:t.username,callback:function(e){t.username=e},expression:"username"}}),t._v(" "),n("Input",{staticStyle:{"margin-bottom":"16px"},attrs:{type:"password",size:"large",placeholder:"密码",clearable:"",autocomplete:"on"},on:{"on-enter":t.login},model:{value:t.password,callback:function(e){t.password=e},expression:"password"}}),t._v(" "),n("Button",{attrs:{type:"primary",long:"",size:"large"},on:{click:t.login}},[t._v("登录")])],1)],1)},staticRenderFns:[]};var z=n("Z0/y")({name:"Login",data:function(){return{username:"",password:""}},methods:{checkSession:function(){var t=this;this.utils.http.get("/api/session").then(function(e){0===e.status&&t.$router.replace({name:4===e.role?"SalesReport":"GlobalNotice"})}).catch(function(){t.utils.message.unknownError()})},validateLogin:function(){return 0!==this.username.length&&0!==this.password.length||(this.$Message.warning("请完整填写用户名和密码"),!1)},login:function(){var t=this;this.validateLogin()&&this.utils.http.post("/api/session",{role:"operator",username:this.username,password:this.password}).then(function(e){switch(e.status){case 0:t.$Message.success("登录成功"),t.$router.replace({name:4===e.role?"SalesReport":"GlobalNotice"});break;case 4:t.$Message.error("用户名或密码错误");break;case 5:t.$Message.error("您已登录，请不要重复登录"),t.$router.go(-1);break;default:t.utils.message.unknownError()}}).catch(function(){t.utils.message.unknownError()})}},created:function(){this.checkSession()}},D,!1,function(t){n("Y9rZ")},"data-v-4e37549d",null).exports,B={render:function(){var t=this.$createElement;return(this._self._c||t)("div",[this._v("404")])},staticRenderFns:[]};var $=n("Z0/y")({name:"NotFound"},B,!1,function(t){n("EiqQ")},"data-v-4007f05a",null).exports,R={name:"RecommendedFood",data:function(){var t=this;return{isWeightChanged:!1,selectList:[],dataCount:0,loading:!1,columns:[{type:"selection",width:60,align:"center"},{title:"食堂",align:"center",key:"dininghallName"},{title:"商户",align:"center",key:"stallName"},{title:"菜品",align:"center",key:"name"},{title:"添加时间",align:"center",key:"insertTime"},{title:"操作",align:"center",width:200,render:function(e,n){return e("div",[e("Button",{props:{type:"error",size:"small"},style:{marginRight:"5px"},on:{click:function(){var e=n.row.id,i=n.row.name;t.confirmDeleteRecommendedFood(e,i)}}},"刪除"),e("Button",{props:{type:"ghost",size:"small"},on:{click:function(){var e=n.index,i=t.recommendedFoodList;if(0!==e){var a=i.splice(e,1)[0];i.splice(e-1,0,a),t.isWeightChanged=!0}else t.$Message.warning("无法继续提升权重")}},style:{marginRight:"6px"}},[e("Icon",{props:{type:"arrow-up-b",size:16,color:"#2d8cf0"},style:{verticalAlign:"middle"}})]),e("Button",{props:{type:"ghost",size:"small"},on:{click:function(){var e=n.index,i=t.recommendedFoodList;if(e!==i.length-1){var a=i.splice(e,1)[0];i.splice(e+1,0,a),t.isWeightChanged=!0}else t.$Message.warning("无法继续降低权重")}}},[e("Icon",{props:{type:"arrow-down-b",size:16,color:"#2d8cf0"},style:{verticalAlign:"middle"}})])])}}],recommendedFoodList:[],diningHallList:[],stallList:[],foodCategoryList:[],foodList:[],pageNum:1,insertModal:!1,food:"",stall:"",diningHall:"",foodCategory:"",countLimit:this.const.recommendedFoodCountLimit}},methods:{saveWeight:function(){},getRecommendedFood:function(){var t=this;this.loading=!0,this.utils.http.get("/api/recommended-food",{count:this.countLimit}).then(function(e){switch(e.status){case 0:t.loading=!1,t.recommendedFoodList=e.info;var n=!0,i=!1,a=void 0;try{for(var s,o=f()(t.recommendedFoodList);!(n=(s=o.next()).done);n=!0){var r=s.value;r.insertTime=t.changeDateType(r.insertTime)}}catch(t){i=!0,a=t}finally{try{!n&&o.return&&o.return()}finally{if(i)throw a}}break;case 2:t.utils.notLoggedIn()}})},ok:function(){var t=this;""===this.food&&this.$Message.error("请选择菜品"),this.diningHall="",this.stall="",this.foodCategory="",this.loading=!0,this.utils.http.post("/api/recommended-food",{foodId:this.food}).then(function(e){switch(e.status){case 0:t.loading=!1,t.$Message.success("添加成功"),t.food="",t.getRecommendedFood();break;case 2:t.utils.notLoggedIn()}}).catch(function(){return t.utils.unknownError})},diningHallSel:function(t){var e=this;this.utils.http.get("/api/dining-halls/"+t+"/stalls").then(function(t){switch(t.status){case 0:e.stallList=t.info;break;case 2:e.utils.notLoggedIn()}}).catch(function(){return e.utils.unknownError})},stallSel:function(t){var e=this;this.utils.http.get("/api/stalls/"+t+"/food-categories").then(function(t){switch(t.status){case 0:e.foodCategoryList=t.info;break;case 2:e.utils.notLoggedIn()}}).catch(function(){return e.utils.unknownError})},foodCategorySel:function(t){var e=this;this.utils.http.get("/api/food-categories/"+t+"/food").then(function(t){switch(t.status){case 0:e.foodList=t.info;break;case 2:e.utils.notLoggedIn()}}).catch(function(){return e.utils.unknownError})},getDiningHallList:function(){var t=this;this.utils.http.get("/api/dining-halls").then(function(e){switch(e.status){case 0:t.diningHallList=e.info;break;case 2:t.utils.notLoggedIn()}}).catch(function(){return t.utils.unknownError})},confirmDeleteRecommendedFood:function(t,e){var n=this;this.$Modal.confirm({title:"确认删除",content:"您确认要删除"+e+"吗？",onOk:function(){n.deleteRecommendedFood(t,e)}})},deleteRecommendedFood:function(t,e){var n=this;this.loading=!0,this.utils.http.delete("/api/recommended-food/"+t).then(function(t){switch(t.status){case 0:n.loading=!1,n.$Message.success("成功删除"+e),n.getRecommendedFood();break;case 2:n.utils.message.notLoggedIn();break;default:n.utils.message.unknownError()}}).catch(function(){n.utils.message.unknownError()})},confirmBatchDeleteRecommendedFood:function(){var t=this;this.$Modal.confirm({title:"确认删除",content:"您确认要删除这"+this.selectList.length+"个食堂吗？",onOk:function(){var e=[],n=!0,i=!1,a=void 0;try{for(var s,o=f()(t.selectList);!(n=(s=o.next()).done);n=!0){var r=s.value;e.push(r.id)}}catch(t){i=!0,a=t}finally{try{!n&&o.return&&o.return()}finally{if(i)throw a}}t.batchDeleteRecommendedFood(e)}})},batchDeleteRecommendedFood:function(t){var e=this;this.loading=!1,this.utils.http.delete("/api/recommended-food",{idList:t}).then(function(t){switch(t.status){case 0:e.loading=!0,e.$Message.success("删除成功"),e.selectList=[],e.getRecommendedFood();break;case 2:e.utils.message.notLoggedIn();break;default:e.utils.message.unknownError()}}).catch(function(){e.utils.message.unknownError()})},select:function(t){this.selectList=t},selectAll:function(){this.selectList=this.recommendedFoodList},saveChange:function(){var t=this,e=[];for(var n in this.recommendedFoodList)e.push(this.recommendedFoodList[n].id);this.loading=!0,this.utils.http.put("/api/recommended-food/weight",{idList:e}).then(function(e){switch(e.status){case 0:t.$Message.success("权重修改成功"),t.loading=!1,t.isWeightChanged=!1,t.getRecommendedFood();break;case 2:t.utils.message.notLoggedIn();break;default:t.utils.message.unknownError()}}).catch(function(){t.utils.message.unknownError()})},changeDateType:function(t){return this.utils.moment(t).format("YYYY-MM-DD HH:mm")}},created:function(){this.getRecommendedFood(),this.getDiningHallList()}},P={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("Modal",{ref:"addModal",attrs:{title:"添加菜品"},on:{"on-ok":t.ok},model:{value:t.insertModal,callback:function(e){t.insertModal=e},expression:"insertModal"}},[n("Form",{attrs:{"label-position":"top"}},[n("FormItem",{attrs:{label:"食堂"}},[n("Select",{staticStyle:{width:"250px"},on:{"on-change":function(e){t.diningHallSel(t.diningHall)}},model:{value:t.diningHall,callback:function(e){t.diningHall=e},expression:"diningHall"}},t._l(t.diningHallList,function(e){return n("Option",{key:e.id,attrs:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),n("FormItem",{attrs:{label:"商户"}},[n("Select",{staticStyle:{width:"250px"},on:{"on-change":function(e){t.stallSel(t.stall)}},model:{value:t.stall,callback:function(e){t.stall=e},expression:"stall"}},t._l(t.stallList,function(e){return n("Option",{key:e.id,attrs:{value:e.id,selected:""}},[t._v(t._s(e.name))])}))],1),t._v(" "),n("FormItem",{attrs:{label:"菜品分类"}},[n("Select",{staticStyle:{width:"250px"},on:{"on-change":function(e){t.foodCategorySel(t.foodCategory)}},model:{value:t.foodCategory,callback:function(e){t.foodCategory=e},expression:"foodCategory"}},t._l(t.foodCategoryList,function(e){return n("Option",{key:e.id,attrs:{value:e.id,selected:""}},[t._v(t._s(e.name))])}))],1),t._v(" "),n("FormItem",{attrs:{label:"菜品"}},[n("Select",{staticStyle:{width:"250px"},model:{value:t.food,callback:function(e){t.food=e},expression:"food"}},t._l(t.foodList,function(e){return n("Option",{key:e.id,attrs:{value:e.id,selected:""}},[t._v(t._s(e.name))])}))],1)],1)],1),t._v(" "),n("div",{staticStyle:{"margin-bottom":"24px","text-align":"right"}},[n("Button",{attrs:{type:"success",disabled:t.recommendedFoodList.length===t.countLimit},on:{click:function(e){t.insertModal=!0}}},[t._v("添加\n    ")]),t._v(" "),n("Button",{attrs:{type:"error",disabled:0===t.selectList.length},on:{click:t.confirmBatchDeleteRecommendedFood}},[t._v("批量刪除")]),t._v(" "),n("Button",{attrs:{type:"primary",disabled:!t.isWeightChanged},on:{click:t.saveWeight}},[t._v("保存权重")])],1),t._v(" "),n("div",[n("Table",{ref:"selection",attrs:{loading:t.loading,border:"",columns:t.columns,data:t.recommendedFoodList},on:{"on-selection-change":t.select,"on-select-all":t.selectAll}})],1)],1)},staticRenderFns:[]};var T=n("Z0/y")(R,P,!1,function(t){n("0ZKK")},"data-v-37114054",null).exports,N={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"body-background"},[n("div",{staticClass:"title"},[n("DatePicker",{staticStyle:{width:"200px"},attrs:{type:"date",formar:"yyyy-MM-dd",placeholder:"请选择日期"},on:{"on-change":t.getRevenueList},model:{value:t.selTime,callback:function(e){t.selTime=e},expression:"selTime"}})],1),t._v(" "),n("div",{staticClass:"table-body"},[n("div",[n("Table",{attrs:{columns:t.historyColumns,data:t.historyData}})],1),t._v(" "),t.dataCount>t.pageSize?n("div",{staticStyle:{float:"right","margin-top":"24px"}},[n("Page",{attrs:{loading:t.loading,total:t.dataCount,"page-size":t.pageSize,"show-total":""},on:{"on-change":t.changePage}})],1):t._e()])])])},staticRenderFns:[]};var A=n("Z0/y")({name:"RevenueList",data:function(){return{dataCount:0,pageSize:8,historyColumns:[{title:"序号",align:"center",type:"index"},{title:"食堂名称",align:"center",key:"diningHallName"},{title:"商户名称",align:"center",key:"stallName"},{title:"日收益",align:"center",key:"money"}],loading:!1,historyData:[],pageNum:1,selTime:""}},methods:{changePage:function(t){var e=this;this.loading=!0,this.pageNum=t,this.utils.http.get("/api/stalls/statistics/revenue",{date:this.selTime,pageNum:this.pageNum,pageSize:this.pageSize}).then(function(t){switch(t.status){case 0:e.loading=!1,e.historyData=t.message.pageList,e.dataCount=t.message.count;break;case 2:e.utils.notLoggedIn()}}).catch(function(){return e.utils.unknownError})},getRevenueList:function(t){var e=this;this.selTime=t,this.loading=!0,this.utils.http.get("/api/stalls/statistics/revenue",{date:t,pageSize:this.pageSize,pageNum:this.pageNum}).then(function(t){switch(t.status){case 0:e.loading=!1,null!=t.message.pageList?(e.historyData=t.message.pageList,e.dataCount=t.message.count):(e.historyData=[],e.dataCount=0);break;case 2:e.utils.notLoggedIn()}}).catch(function(){return e.utils.unknownError})}}},N,!1,function(t){n("1aF/")},"data-v-222a31f6",null).exports,q={render:function(){var t=this.$createElement;return(this._self._c||t)("div")},staticRenderFns:[]};var U=n("Z0/y")({name:"SalesReport"},q,!1,function(t){n("FBqa")},"data-v-8b4dcd24",null).exports,V={name:"Stall",data:function(){var t=this;return{stall:[{type:"selection",width:60,align:"center",value:1},{title:"商户图片",key:"imageUrl",render:function(e,n){return console.log(n.row),e("div",{attrs:{style:"width: 40px;height: 40px;"}},[e("img",{props:{type:"primary",size:"small"},attrs:{src:t.const.imagePath.stall+n.row.imageUrl,style:"width: 40px;height: 40px;border-radius: 2px;"},style:{}})])}},{title:"商户名称",key:"name"},{title:"用户名",key:"name"},{title:"更新时间",key:"updateTime"},{title:"操作",key:"aa",render:function(e,n){return e("div",[e("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){t.show(n.row.id)}}},"修改"),e("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){t.del(n.row.id)}}},"删除"),e("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){t.show(n.index)}}},"排序")])}}],count:[],count1:[],count2:[],id:"",username:"",sname:"",password:"",file:"",selection:[],modal1:!1}},methods:{showDiv:function(){var t=this;this.$Modal.confirm({render:function(e,n){return e("div",[e("img",{props:{type:"primary",size:"small"},attrs:{src:t.const.imagePath.stall+t.count2.imageUrl,style:"width: 40px;height: 40px;border-radius: 2px;"},style:{}}),"商户名:",e("Input",{props:{value:t.count2.name},on:{"on-change":function(e){t.sname=e.path[0].value}}}),"用户名",e("Input",{props:{value:t.count2.username},on:{"on-change":function(e){t.username=e.path[0].value}}}),"密码:",e("Input",{props:{value:t.count2.password},on:{"on-change":function(e){t.password=e.path[0].value}}})])},onOk:function(){t.utils.http.put("/api/stalls/"+t.count2.id,{name:t.sname,username:t.username,password:t.password}).then(function(t){alert(1)}).catch(function(t){console.log(t)})}})},show:function(t){var e=this;this.utils.http.get("/api/stalls/"+t).then(function(t){e.count2=t.info,console.log(t.info),e.showDiv()})},insertDiv:function(t){var e=this;this.id=t,this.$Modal.confirm({render:function(t,n){return t("div",[t("Button",{props:{type:"ghost",size:"small",icon:"ios-cloud-upload-outline"},style:{marginRight:"5px"},on:{"on-change":function(t){e.file=t.path[0].value}}},"上传头像"),"商户名",t("Input",{on:{"on-change":function(t){e.sname=t.path[0].value}}}),"用户名",t("Input",{on:{"on-change":function(t){e.username=t.path[0].value}}}),"密码",t("Input",{props:{value:e.count2.password},on:{"on-change":function(t){e.password=t.path[0].value}}})])},onOk:function(){e.utils.http.post("/api/dining-halls/"+e.id+"/stalls",{name:e.sname,username:e.username,password:e.password}).then(function(t){e.created()}).catch(function(t){console.log(t)})}})},upd:function(t){},del:function(t){this.utils.http.delete("/api/stalls/"+t),this.stallinit()},stallinit:function(){var t=this;this.utils.http.get("/api/dining-halls").then(function(e){t.count=e.info,console.log(e.info[0].id)})},selectmsg:function(t){var e=this;this.utils.http.get("/api/dining-halls/"+t+"/stalls").then(function(t){console.log(t),e.count1=t.info})}},created:function(){this.stallinit(),this.selectmsg(1)}},O={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticStyle:{"margin-top":"50px"}},[n("Tabs",{attrs:{type:"card",animated:!1},on:{"on-click":function(e){t.selectmsg(t.model)}},model:{value:t.model,callback:function(e){t.model=e},expression:"model"}},t._l(t.count,function(e){return n("TabPane",{key:e.id,attrs:{label:e.name,name:e.id,value:"c.id"}},[n("div",{staticStyle:{margin:"10px 1300px",width:"1500px"}},[n("sapn",[n("Button",{attrs:{type:"primary"},on:{click:function(e){t.modal1=!0}}},[t._v("添加")]),t._v(" "),n("Modal",{attrs:{title:"新建商户"},on:{"on-ok":function(n){t.ok(e.id)},"on-cancel":t.cancel},model:{value:t.modal1,callback:function(e){t.modal1=e},expression:"modal1"}},[n("p",[n("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"请输入商户名"},model:{value:t.sname,callback:function(e){t.sname=e},expression:"sname"}})],1),t._v(" "),n("p",[n("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"请输入用户名"},model:{value:t.username,callback:function(e){t.username=e},expression:"username"}})],1),t._v(" "),n("p",[n("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"请输入密码"},model:{value:t.password,callback:function(e){t.password=e},expression:"password"}})],1)])],1),t._v(" "),n("span",[n("Button",{attrs:{type:"error"},on:{click:t.handleRowChange}},[t._v("批量删除")])],1),t._v(" "),n("span",[n("Button",{attrs:{type:"info"}},[t._v("保存")])],1)],1),t._v(" "),n("Table",{attrs:{id:"stall",columns:t.stall,data:t.count1}})],1)}))],1)])},staticRenderFns:[]},W=n("Z0/y")(V,O,!1,null,null,null).exports;i.default.use(o.a);var Y=new o.a({routes:[{path:"*",name:"NotFound",component:$},{path:"/",redirect:{name:"Login"}},{path:"/login",name:"Login",component:z},{path:"/",component:g,children:[{path:"banner",name:"Banner",component:b},{path:"dining-hall",name:"DiningHall",component:F},{path:"feedback",name:"Feedback",component:j},{path:"food",name:"Food",component:C},{path:"global-notice",name:"GlobalNotice",component:H},{path:"recommended-food",name:"RecommendedFood",component:T},{path:"revenue-list",name:"RevenueList",component:A},{path:"sales-report",name:"SalesReport",component:U},{path:"stall",name:"Stall",component:W}]}]}),Z=(n("m7aY"),n("oiyU")),G=n.n(Z),X=(n("s72s"),{appName:"准点订餐系统",contextPath:"/food-ordering/",imagePath:{diningHall:"/food-ordering/upload/image/dining-hall/",stall:"/food-ordering/upload/image/stall/",food:"/food-ordering/upload/image/food/",banner:"/food-ordering/upload/image/banner/"},recommendedFoodCountLimit:3,upload:{image:{acceptMimeTypes:"image/jpeg, image/png",maxSize:5242880}}}),K=n("3cXf"),J=n.n(K),Q=n("aozt"),tt=n.n(Q),et=n("DEjr"),nt=n.n(et),it=n("pkma"),at={http:{post:function(t,e){return st(t,"POST",e)},get:function(t,e){return st(t,"GET",e)},put:function(t,e){return st(t,"PUT",e)},delete:function(t,e){return st(t,"DELETE",e)}},moment:n.n(it).a,message:{notLoggedIn:function(){window.vm.$Message.error("请登录后再进行操作"),window.vm.$router.push("Login")},unknownError:function(){window.vm.$Message.error("未知错误")}},cloneObject:function(t){return JSON.parse(J()(t))}};function st(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};t=t.startsWith("/")?X.contextPath+t.substring(1):t;var i=e;"PUT"!==e&&"DELETE"!==e||(i="POST",n._method=e);var a=!1;for(var s in n)if(n[s]instanceof File){a=!0;break}var o=void 0;if(a){o="multipart/form-data";var r=new FormData;for(var l in n)r.append(l,n[l]);n=r}else o="application/x-www-form-urlencoded";var c=void 0!==window.vm,d=c?window.vm.$Loading:void 0;return c&&d.start(),new w.a(function(s,r){tt.a.request({url:t,method:i,headers:{"Content-Type":o},data:"GET"===e?void 0:n,params:"GET"===e?n:void 0,transformRequest:[function(t){if(a)return t;for(var e in t)t.hasOwnProperty(e)&&t[e]instanceof Object&&(t[e]=J()(t[e]));return nt.a.stringify(t)}],timeout:1e4}).then(function(t){c&&d.finish(),s(t.data)}).catch(function(t){c&&d.error(),t.cause="request",r(t)})})}i.default.config.productionTip=!1,i.default.use(G.a),i.default.prototype.const=X,i.default.prototype.utils=at,window.vm=new i.default({el:"#app",router:Y,components:{App:s},template:"<App/>"}),G.a.LoadingBar.config({height:3}),Y.beforeEach(function(t,e,n){G.a.LoadingBar.start(),n()}),Y.afterEach(function(){G.a.LoadingBar.finish()})},S5xm:function(t,e){},SGix:function(t,e){},TxhG:function(t,e){},Xps3:function(t,e){},Y9rZ:function(t,e){},cHse:function(t,e){},hPbS:function(t,e){},m7aY:function(t,e){},nBlQ:function(t,e){},s72s:function(t,e){}},[0]);